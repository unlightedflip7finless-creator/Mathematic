<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dividend Reduction Processor | Bauhaus & macOS UI</title>
    
    <!-- Scripts for Build-less React -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #F2F2F7; }
        .macos-window {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(40px) saturate(200%);
            -webkit-backdrop-filter: blur(40px) saturate(200%);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        .math-container .katex-display { margin: 0.5em 0; font-size: 1.1em; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // --- Lucide Icons Mock (SVG) ---
        const CalculatorIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>
        );

        const MathBlock = ({ tex }) => {
            const containerRef = useRef(null);
            useEffect(() => {
                if (window.katex && containerRef.current) {
                    window.katex.render(tex, containerRef.current, { displayMode: true, throwOnError: false });
                }
            }, [tex]);
            return <div ref={containerRef} className="math-container overflow-x-auto" />;
        };

        const App = () => {
            const [inputs, setInputs] = useState({
                divPrior: 70,
                divPriorPrior: 50,
                totalCapital: 1000,
                issuedShares: 20000,
            });

            const [results, setResults] = useState(null);
            const [isCalculating, setIsCalculating] = useState(false);

            const calculate = useCallback(() => {
                setIsCalculating(true);
                setTimeout(() => {
                    const avgDivTotal = ((inputs.divPrior + inputs.divPriorPrior) / 2) * 10000;
                    const capitalPerShare = (inputs.totalCapital * 10000) / inputs.issuedShares;
                    const divPerShare = avgDivTotal / inputs.issuedShares;
                    const reductionRatio = capitalPerShare / 50; 
                    const d50 = divPerShare / reductionRatio;
                    const v50 = d50 / 0.1;
                    const finalVal = v50 * reductionRatio;

                    setResults({ avgDivTotal, capitalPerShare, divPerShare, reductionRatio, d50, v50, finalVal });
                    setIsCalculating(false);
                }, 300);
            }, [inputs]);

            useEffect(() => { calculate(); }, []);

            if (!results) return null;

            return (
                <div className="min-h-screen flex items-center justify-center p-6 lg:p-12">
                    <div className="macos-window w-full max-w-6xl h-[850px] shadow-2xl rounded-2xl flex flex-col overflow-hidden">
                        
                        {/* Title Bar */}
                        <div className="h-12 border-b border-black/5 flex items-center px-4 justify-between bg-white/40">
                            <div className="flex space-x-2 w-32">
                                <div className="w-3 h-3 rounded-full bg-[#FF5F57] border border-[#E24B40]" />
                                <div className="w-3 h-3 rounded-full bg-[#FEBC2E] border border-[#D8A124]" />
                                <div className="w-3 h-3 rounded-full bg-[#28C840] border border-[#20A132]" />
                            </div>
                            <div className="text-[11px] font-bold text-black/40 tracking-widest uppercase">Dividend Reduction Processor</div>
                            <div className="w-32" />
                        </div>

                        <div className="flex-1 flex overflow-hidden">
                            {/* Sidebar */}
                            <aside className="w-80 bg-black/[0.02] border-r border-black/5 p-8 flex flex-col">
                                <div className="flex items-center space-x-3 mb-10">
                                    <div className="bg-blue-600 p-2 rounded-xl text-white shadow-lg shadow-blue-200">
                                        <CalculatorIcon />
                                    </div>
                                    <span className="font-bold text-sm">CONTROL</span>
                                </div>

                                <div className="flex-1 space-y-6">
                                    {Object.entries({
                                        divPrior: ["直前期配当", "万円"],
                                        divPriorPrior: ["直前々期配当", "万円"],
                                        totalCapital: ["資本金等の額", "万円"],
                                        issuedShares: ["発行済株式数", "株"]
                                    }).map(([key, [label, unit]]) => (
                                        <div key={key}>
                                            <label className="text-[10px] font-bold text-black/40 uppercase tracking-widest ml-1 mb-1.5 block">{label}</label>
                                            <div className="relative">
                                                <input 
                                                    type="number" 
                                                    className="w-full bg-white border border-black/10 rounded-lg px-3 py-2.5 text-sm font-mono focus:ring-4 focus:ring-blue-500/10 outline-none transition-all shadow-sm"
                                                    value={inputs[key]}
                                                    onChange={e => setInputs({...inputs, [key]: parseFloat(e.target.value) || 0})}
                                                />
                                                <span className="absolute right-3 top-1/2 -translate-y-1/2 text-[9px] font-bold text-black/20">{unit}</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                <button 
                                    onClick={calculate}
                                    className="mt-8 w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl font-bold text-sm shadow-xl shadow-blue-500/20 active:scale-95 transition-all flex items-center justify-center space-x-2"
                                >
                                    {isCalculating ? <span>COMPUTING...</span> : <span>再計算を実行</span>}
                                </button>
                            </aside>

                            {/* Main Display */}
                            <main className={`flex-1 p-12 overflow-y-auto transition-opacity duration-300 ${isCalculating ? 'opacity-30' : 'opacity-100'}`}>
                                <section className="mb-12">
                                    <h2 className="text-2xl font-bold tracking-tight mb-8">還元プロセスの構造</h2>
                                    <div className="grid grid-cols-4 gap-0 rounded-2xl border border-black/5 overflow-hidden shadow-sm bg-white">
                                        <div className="p-5 border-b border-r bg-gray-50/50 text-[10px] font-bold text-black/30">属性</div>
                                        <div className="p-5 border-b border-r text-xs font-semibold">本来数値 (総額)</div>
                                        <div className="p-5 border-b border-r text-xs font-semibold">一株換算 (実数)</div>
                                        <div className="p-5 border-b bg-blue-50/30 text-xs font-bold text-blue-600 italic">50円還元 (標準化)</div>

                                        <div className="p-5 border-r bg-gray-50/50 text-[10px] font-bold text-black/40">資本金</div>
                                        <div className="p-5 border-r text-sm font-mono">{inputs.totalCapital.toLocaleString()}万</div>
                                        <div className="p-5 border-r text-sm font-mono">{Math.round(results.capitalPerShare)}円</div>
                                        <div className="p-5 bg-blue-50/30 text-sm font-bold text-blue-600">50.00円</div>

                                        <div className="p-5 border-r bg-gray-50/50 text-[10px] font-bold text-black/40">配当金</div>
                                        <div className="p-5 border-r text-sm font-mono">{((inputs.divPrior + inputs.divPriorPrior)/2).toLocaleString()}万</div>
                                        <div className="p-5 border-r text-sm font-mono text-black/30">{results.divPerShare.toFixed(1)}円</div>
                                        <div className="p-5 bg-blue-50/30 text-sm font-bold text-blue-600">{results.d50.toFixed(2)}円</div>
                                    </div>
                                </section>

                                <section className="space-y-8">
                                    <h2 className="text-2xl font-bold tracking-tight mb-8 flex items-center space-x-3">
                                        <div className="w-2 h-8 bg-blue-500 rounded-full" />
                                        <span>論理導出プロセス</span>
                                    </h2>

                                    <div className="space-y-6">
                                        <div className="bg-white p-8 rounded-3xl border border-black/[0.03] shadow-sm">
                                            <p className="text-[10px] font-bold text-blue-500 uppercase tracking-widest mb-4">Phase 1: Standardization</p>
                                            <MathBlock tex={`D_{50} = \\frac{(${inputs.divPrior} + ${inputs.divPriorPrior}) \\div 2 \\times 10^4}{${inputs.totalCapital} \\times 10^4 \\div 50} = \\mathbf{${results.d50.toFixed(2)} \\text{円}}`} />
                                        </div>

                                        <div className="bg-white p-8 rounded-3xl border border-black/[0.03] shadow-sm">
                                            <p className="text-[10px] font-bold text-purple-500 uppercase tracking-widest mb-4">Phase 2: Capitalization</p>
                                            <MathBlock tex={`V_{50} = \\frac{${results.d50.toFixed(2)} \\text{円}}{0.1} = \\mathbf{${results.v50.toFixed(0)} \\text{円}}`} />
                                        </div>

                                        <div className="bg-[#1D1D1F] text-white p-10 rounded-3xl shadow-2xl">
                                            <p className="text-[10px] font-bold text-yellow-400 uppercase tracking-widest mb-6">Final Phase: Scaling</p>
                                            <MathBlock tex={`V = ${results.v50.toFixed(0)} \\times \\frac{${Math.round(results.capitalPerShare)}}{50} = \\color{yellow}{\\mathbf{${Math.round(results.finalVal).toLocaleString()} \\text{円}}}`} />
                                            <div className="mt-8 p-5 bg-white/5 rounded-2xl border border-white/10 text-white/70 text-sm leading-relaxed">
                                                標準化された50円あたりの価値を、実際の1株あたり資本金サイズに戻すことで最終的な評価額が確定します。
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </main>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
